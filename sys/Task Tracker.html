<!-- <!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <title>Task Tracker</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
<style>
    /* styles for the task tracker application */
      .task-container {
        border: 1px solid #dee2e6;
        border-radius: .25rem;
        padding: 10px;
        margin-bottom: 20px;
      }

      .task-table {
        width: 100%;
        margin: 0;
        border-collapse: collapse;
      }

      .task-table th,
      .task-table td {
        border: 1px solid #dee2e6;
        padding: 10px;
        text-align: left;
        vertical-align: top;
      }

      .task-table th {
        background-color: #f8f9fa;
      }

      .task-table tr:hover {
        background-color: #e2e6ea;
      }

      /* styles for form and input fields */
      .form-group {
        margin-bottom: 1rem;
      }

      .form-label {
        margin-bottom: .5rem;
      }

      .input-group-btn {
        width: auto;
      }

      .btn-primary {
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
      }

      .btn-primary:hover {
        color: #fff;
        background-color: #0069d9;
        border-color: #0062cc;
      }

      tr[data-status="new"] {
        background-color: #d59c90;
      }

      tr[data-status="ongoing"] {
        background-color: #fff3cd;
      }

      tr[data-status="completed"] {
        background-color: #d4edda;
      }
    body {
      padding-bottom: 60px;
    }
    .footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 60px;
      background-color: #f5f5f5;
    }
    </style>
</head>
<!-- <body onload="loadDropdown()"> -->
<!-- Top Navigation Menu -->
<!--  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">My Website</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="Home.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">About</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Function
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <a class="dropdown-item" href="taskPriority.html">Priority Tracker</a>
            <a class="dropdown-item" href="Daily Expense Tracker.html">Daily Expense Tracker</a>
            <a class="dropdown-item" href="Task Tracker.html">Task Tracker</a>
            <a class="dropdown-item" href="Planner.html">Planner</a>
            <a class="dropdown-item" href="Stock Inventory.html">Stock Inventory</a>
          </div>
        </li>
      </ul>
    </div>
  </nav> -->
<br><br>
<div class="row justify-content-center">
    <h1>Task Tracker</h1>
</div>
<div class="container">
    <div class="form-group">
        <label for="username-dropdown">Username:</label>
        <select class="form-control" id="username-dropdown"></select>
    </div>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Set Username List</button>
</div>
<div class="input-group row justify-content-center">
    <form class="col-md-12 col-lg-6" autocomplete="off">
        <div class="form-group row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <label for="task-name" class="form-label">Task name:</label>
                <div class="input-group">
                    <input type="text" id="task-name" class="form-control" required>
                </div>
            </div>
            <div class="col-md-8 col-lg-6">
                <label for="task-desc" class="form-label">Task Description:</label>
                <div class="input-group">
                    <input type="text" id="task-desc" class="form-control" required>
                </div>
            </div>
        </div>
        <div class="input-group row">
            <div class="col-md-12 text-center">
                <button type="button" class="btn btn-primary" onclick="addTasks()"> Add Task <i class="fas fa-plus"></i>
                </button>
                <!-- <button type="button" class="btn btn-success" onclick="saveTasks()">Save Tasks <i class="fa fa-save"></i></button> -->
                <button type="button" class="btn btn-warning" onclick="loadTasks()">Load Tasks <i class="fa-solid fa-upload"></i>
                </button>
                <button type="button" class="btn btn-danger" onclick="clearTasks()">Clear Storage <i class="fa-solid fa-eraser"></i>
                </button>
            </div>
        </div>
        <hr />
</div>
<div class="input-group row">
    <div class="col-md-4">
        <div class="task-container" ondrop="drop(event)" ondragover="allowDrop(event)" ontouchleave="drop(event)">
            <h2 class="mb-3">New</h2>
            <table id="new" class="task-table">
                <thead>
                    <tr>
                        <th>Task Name</th>
                        <th>Description</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <div class="col-md-4">
        <div class="task-container" ondrop="drop(event)" ondragover="allowDrop(event)" ontouchleave="drop(event)">
            <h2 class="mb-3">Ongoing</h2>
            <table id="ongoing" class="task-table">
                <thead>
                    <tr>
                        <th>Task Name</th>
                        <th>Description</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <div class="col-md-4">
        <div class="task-container" ondrop="drop(event)" ondragover="allowDrop(event)" ontouchleave="drop(event)">
            <h2 class="mb-3">Completed</h2>
            <table id="completed" class="task-table">
                <thead>
                    <tr>
                        <th>Task Name</th>
                        <th>Description</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    </form>
</div>
<!-- Footer -->
<!--   <footer class="footer fixed-bottom bg-light">
    <div class="container">
      <p class="text-muted">My Website &copy; 2023</p>
    </div>
  </footer> -->
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Set Username List</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label for="username-list">Enter a comma-separated list of usernames:</label>
                <textarea class="form-control" id="username-list" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveUsernameList()">Save changes</button>
            </div>
        </div>
    </div>
</div>
<!-- Link to jQuery and Bootstrap JavaScript files -->
<!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->
<!-- Custom JavaScript code -->
<script>
$(document).ready(function() {
    loadDropdown();
});

var draggedItem;

function dragStart(event) {
    draggedItem = event.target;
    event.dataTransfer.setData("text/plain", draggedItem.dataset.status);
    event.dataTransfer.effectAllowed = "move";
}

function allowDrop(event) {
    event.preventDefault();
}

function drop(event) {
    event.preventDefault();
    var fromList = draggedItem.parentNode;
    var toTable = event.target.closest(".task-container").querySelector(".task-table");
    var status = toTable.id;
    if (draggedItem.tagName === "TR" && toTable.classList.contains("task-table")) {
        switch (status) {
            case "ongoing":
                draggedItem.dataset.status = "ongoing";
                break;
            case "completed":
                draggedItem.dataset.status = "completed";
                break;
            default:
                draggedItem.dataset.status = "new";
        }
        toTable.querySelector('tbody').appendChild(draggedItem);
        saveTasks();
    }
}

function addTasks() {
    var taskNameInput = document.getElementById("task-name");
    var taskDescInput = document.getElementById("task-desc");
    var newTaskName = taskNameInput.value.trim();
    var newTaskDesc = taskDescInput.value;
    if (newTaskName.length > 0) {
        // Create a new 'Delete' icon
        var deleteButton = document.createElement("i");
        deleteButton.classList.add("fa", "fa-trash-alt");
        deleteButton.textContent = "";
        // Create a new task row
        var newTaskRow = document.createElement("tr");
        // Create a new task name cell
        var newTaskNameCell = document.createElement("td");
        newTaskNameCell.textContent = newTaskName;
        newTaskRow.appendChild(newTaskNameCell);
        // Create a new task description cell
        var newTaskDescCell = document.createElement("td");
        newTaskDescCell.textContent = newTaskDesc;
        newTaskDescCell.dataset.status = "new";
        newTaskRow.appendChild(newTaskDescCell);
        // Create a new delete button cell
        var deleteButtonCell = document.createElement("td");
        deleteButtonCell.appendChild(deleteButton);
        newTaskRow.appendChild(deleteButtonCell);
        // Set the data-status and draggable attributes
        newTaskRow.draggable = true;
        newTaskRow.dataset.status = "new";
        newTaskRow.addEventListener("dragstart", dragStart);
        newTaskRow.addEventListener("touchmove", dragStart);
        // Add event listener to the delete button
        deleteButton.addEventListener("click", function() {
            newTaskRow.remove();
            saveTasks();
        });
        // Append the new task row to the 'new' task table
        document.getElementById("new").querySelector('tbody').appendChild(newTaskRow);
        saveTasks();
    }
    taskNameInput.value = "";
    taskNameInput.focus();
}

function saveTasks() {
    // Get Username
    var usernameInput = document.getElementById("username-dropdown").value;
    // Get all task tables
    var taskTables = document.querySelectorAll('.task-table');


    var statusData = [];
    // Loop through each table
    for (var i = 0; i < taskTables.length; i++) {
        // console.log(taskTables[i].id);
        var taskTableRows = taskTables[i].querySelectorAll('tbody tr');
        var taskTableData = [];
        // Loop through each row in the table
        for (var j = 0; j < taskTableRows.length; j++) {
            var taskTableRowData = {
                name: taskTableRows[j].querySelector('td:first-child').textContent,
                description: taskTableRows[j].querySelector('td:nth-child(2)').textContent,
                status: taskTableRows[j].dataset.status || 'new' // use 'new' if data-status is not defined
            };
            taskTableData.push(taskTableRowData);
        }
        // Save the table data to local storage
        // localStorage.setItem(taskTables[i].id, JSON.stringify(taskTableData));
        var taskTableStatusData = {
            taskData: taskTableData
        };
        statusData.push(taskTableStatusData);
    }
    console.log("statusDate", statusData);
    // Save the table data to local storage
    localStorage.setItem(usernameInput, JSON.stringify(statusData));
}

function loadTasks() {
    // Get Username
    var usernameInput = document.getElementById("username-dropdown").value;
    console.log(usernameInput);
    var taskTables = document.querySelectorAll('.task-table');

    var userData = JSON.parse(localStorage.getItem(usernameInput));
    console.log(userData);

    for (var i = 0; i < taskTables.length; i++) {
        // var taskTableData = JSON.parse(localStorage.getItem(taskTables[i].id));
        var taskTableData = userData[i].taskData;
        // if (taskTableData) {
        for (var j = 0; j < taskTableData.length; j++) {
            // Create a new 'Delete' icon
            var deleteButton = document.createElement("i");
            deleteButton.classList.add("fa", "fa-trash-alt");
            deleteButton.textContent = "";
            var taskTableRowData = taskTableData[j];
            console.log("taskTableRowData", taskTableRowData);
            var taskTableRow = document.createElement('tr');
            var taskNameCell = document.createElement('td');
            var taskDescCell = document.createElement('td');
            taskNameCell.textContent = taskTableRowData.name;
            taskDescCell.textContent = taskTableRowData.description;
            taskTableRow.dataset.status = taskTableRowData.status || 'new'; // use 'new' if status is not defined
            // Create a new delete button cell
            var deleteButtonCell = document.createElement("td");
            deleteButtonCell.appendChild(deleteButton);
            // Add event listener to the delete button
            deleteButton.addEventListener("click", function() {
                newTaskRow.remove();
                saveTasks();
            });
            taskTableRow.draggable = true;
            taskTableRow.addEventListener('dragstart', dragStart);
            taskTableRow.addEventListener("touchmove", dragStart);
            taskTableRow.appendChild(taskNameCell);
            taskTableRow.appendChild(taskDescCell);
            taskTableRow.appendChild(deleteButtonCell);
            taskTables[i].querySelector('tbody').appendChild(taskTableRow);
        }
        // }
    }
}

function clearTasks() {
    // // Get all task tables
    // var taskTables = document.querySelectorAll('.task-table');
    // // Loop through each table
    // for (var i = 0; i < taskTables.length; i++) {
    //   // Remove the table data from local storage
    //   localStorage.removeItem(taskTables[i].id);
    // }
    localStorage.clear();
    location.reload();
}

function deleteTask(event) {
    var taskRow = event.target.closest('tr');
    if (taskRow) {
        taskRow.remove();
        saveTasks();
    }
}

function loadDropdown() {
    // Get username list from LocalStorage
    var usernameList = localStorage.getItem("usernameList");
    if (usernameList) {
        // Split the comma-separated string into an array of usernames
        var usernames = usernameList.split(",");
        // Sort the usernames in alphabetical order
        usernames.sort();
        // Populate the dropdown with the list of usernames
        var dropdown = document.getElementById("username-dropdown");
        for (var i = 0; i < usernames.length; i++) {
            var option = document.createElement("option");
            option.text = usernames[i];
            dropdown.add(option);
        }
    } else {
        // If username list not found in LocalStorage, display the "Set Username List" button
        var button = document.getElementsByTagName("button")[0];
        button.style.display = "block";
    }
}

function saveUsernameList() {
    // Get the comma-separated list of usernames entered by the user
    var usernameList = document.getElementById("username-list").value;
    // Remove any leading or trailing whitespace
    usernameList = usernameList.trim();
    // Split the comma-separated string into an array of usernames
    var usernames = usernameList.split(",");
    // Sort the usernames in alphabetical order
    usernames.sort();
    // Store the sorted list of usernames in LocalStorage
    localStorage.setItem("usernameList", usernames.join(","));
    // Reload the page to populate the dropdown with the new username list
    location.reload();
}
</script>
</body>

</html>